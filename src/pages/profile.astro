---
import "../styles/global.css";
import NavbarAuth from "../components/ui/NavbarAuth.astro";
import ProfileForm from "../components/features/ProfileForm.astro";
import DocumentUpload from "../components/features/DocumentUpload.astro";

// Note: Authentication is checked client-side since Supabase uses localStorage
---

<!doctype html>
<html lang="it">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Il tuo profilo personale - Dai Vai" />
        <title>Profilo | Dai Vai</title>

        <!-- Favicon -->
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/daivai/favicon/apple-touch-icon.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="/daivai/favicon/favicon-32x32.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="/daivai/favicon/favicon-16x16.png"
        />
        <link rel="manifest" href="/daivai/favicon/site.webmanifest" />
        <link rel="shortcut icon" href="/daivai/favicon/favicon.ico" />

        <!-- Favicon SVG -->
        <link
            rel="icon"
            type="image/svg+xml"
            href="/daivai/images/DaiVai.svg"
        />

        <!-- Font preload -->
        <link
            rel="preload"
            href="/daivai/fonts/condenso/Condenso-Regular.woff2"
            as="font"
            type="font/woff2"
            crossorigin
        />

        <!-- Theme color -->
        <meta name="theme-color" content="#FB6068" />
    </head>

    <body>
        <NavbarAuth />

        <main class="profile-page">
            <div id="loading-profile" class="loading-container">
                <p>Caricamento profilo...</p>
            </div>

            <div
                id="profile-container"
                class="profile-container"
                style="display: none;"
            >
                <header class="profile-header">
                    <h1 class="condenso-text">
                        Il <span class="highlight">Tuo</span> Profilo
                    </h1>
                    <p class="profile-subtitle">
                        Gestisci i tuoi dati personali e documenti
                    </p>
                    <div
                        id="admin-badge"
                        class="admin-badge"
                        style="display: none;"
                    >
                        <span>üîë Admin</span>
                    </div>
                </header>

                <div class="profile-content" id="profile-content">
                    <!-- ProfileForm and DocumentUpload will be inserted here -->
                </div>

                <div class="profile-actions">
                    <a href="/daivai/" class="btn-back">‚Üê Torna alla Home</a>
                    <button id="logout-btn" class="btn-logout">Esci</button>
                    <a
                        href="/daivai/admin"
                        id="admin-link"
                        class="btn-admin"
                        style="display: none;"
                    >
                        Pannello Admin
                    </a>
                </div>
            </div>
        </main>

        <script>
            import { supabase } from "../lib/supabase";
            import { getCurrentUserProfile } from "../lib/supabase";

            async function loadProfile() {
                const loadingEl = document.getElementById("loading-profile");
                const containerEl =
                    document.getElementById("profile-container");
                const contentEl = document.getElementById("profile-content");
                const adminBadge = document.getElementById("admin-badge");
                const adminLink = document.getElementById("admin-link");

                try {
                    // Check authentication
                    const {
                        data: { user },
                    } = await supabase.auth.getUser();

                    if (!user) {
                        window.location.href = "/daivai/login";
                        return;
                    }

                    // Get profile
                    const { data: profile, error } =
                        await getCurrentUserProfile();

                    if (error || !profile) {
                        console.error("Profile error:", error);
                        window.location.href = "/daivai/login";
                        return;
                    }

                    // Show admin badge if admin
                    if (profile.role === "admin") {
                        if (adminBadge)
                            adminBadge.style.display = "inline-block";
                        if (adminLink) adminLink.style.display = "inline-block";
                    }

                    // Render ProfileForm
                    const formHTML = `
                        <div class="form-section">
                            <div class="form-header">
                                <h3>Dati Personali</h3>
                                <button type="button" id="edit-toggle-btn" class="btn-edit-toggle">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                    Modifica Profilo
                                </button>
                            </div>
                            <form id="profile-form">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="email">Email</label>
                                        <input type="email" id="email" value="${profile.email || ""}" readonly class="always-readonly" />
                                    </div>
                                    <div class="form-group">
                                        <label for="first_name">Nome</label>
                                        <input type="text" id="first_name" value="${profile.first_name || ""}" placeholder="Mario" readonly class="editable-field" />
                                    </div>
                                    <div class="form-group">
                                        <label for="last_name">Cognome</label>
                                        <input type="text" id="last_name" value="${profile.last_name || ""}" placeholder="Rossi" readonly class="editable-field" />
                                    </div>
                                    <div class="form-group">
                                        <label for="birth_date">Data di Nascita</label>
                                        <input type="date" id="birth_date" value="${profile.birth_date || ""}" readonly class="editable-field" />
                                    </div>
                                    <div class="form-group">
                                        <label for="phone">Telefono</label>
                                        <input type="tel" id="phone" value="${profile.phone || ""}" placeholder="+39 123 456 7890" readonly class="editable-field" />
                                    </div>
                                    <div class="form-group full-width">
                                        <label for="address">Indirizzo</label>
                                        <input type="text" id="address" value="${profile.address || ""}" placeholder="Via Roma, 10" readonly class="editable-field" />
                                    </div>
                                    <div class="form-group">
                                        <label for="city">Citt√†</label>
                                        <input type="text" id="city" value="${profile.city || ""}" placeholder="Verona" readonly class="editable-field" />
                                    </div>
                                    <div class="form-group">
                                        <label for="postal_code">CAP</label>
                                        <input type="text" id="postal_code" value="${profile.postal_code || ""}" placeholder="37100" pattern="[0-9]{5}" readonly class="editable-field" />
                                    </div>
                                </div>
                                <div class="form-actions" style="display: none;">
                                    <button type="submit" class="btn-submit">Salva Modifiche</button>
                                    <button type="button" id="cancel-edit-btn" class="btn-cancel">Annulla</button>
                                </div>
                                <div id="form-status" class="form-status"></div>
                            </form>
                        </div>

                        <div class="document-section">
                            <h3>Documento Personale</h3>
                            ${
                                profile.document_url
                                    ? `
                                <div class="document-preview">
                                    <p>Documento caricato</p>
                                    <div class="document-actions">
                                        <a href="${profile.document_url}" target="_blank" class="btn-view">Visualizza PDF</a>
                                        <button id="delete-doc" class="btn-delete">Elimina</button>
                                    </div>
                                </div>
                            `
                                    : `
                                <form id="upload-form">
                                    <input type="file" id="doc-file" accept=".pdf" />
                                    <button type="submit" class="btn-upload">Carica Documento</button>
                                    <div id="upload-status" class="upload-status"></div>
                                </form>
                            `
                            }
                        </div>

                        <!-- Danger Zone -->
                        <div class="danger-zone">
                            <div class="danger-header">
                                <h3>Zona Pericolosa</h3>
                                <p>Le azioni in questa sezione sono irreversibili.</p>
                            </div>
                            <button id="delete-account-btn" class="btn-danger">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path></svg>
                                Elimina Profilo
                            </button>
                        </div>

                        <!-- Delete Confirmation Modal -->
                        <div id="delete-modal" class="modal-overlay" style="display: none;">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h3>Elimina Profilo</h3>
                                    <button class="close-modal">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <p>Sei sicuro di voler eliminare il tuo profilo? Questa azione canceller√† tutti i tuoi dati e documenti. <strong>Non potrai tornare indietro.</strong></p>
                                    <div class="confirmation-input">
                                        <label for="confirm-email">Digita la tua email per confermare: <strong>${profile.email}</strong></label>
                                        <input type="email" id="confirm-email" placeholder="${profile.email}" autocomplete="off">
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn-cancel-modal">Annulla</button>
                                    <button id="confirm-delete-btn" class="btn-delete-confirm" disabled>Elimina Definitivamente</button>
                                </div>
                            </div>
                        </div>
                    `;

                    if (contentEl) contentEl.innerHTML = formHTML;

                    // Show profile, hide loading
                    if (loadingEl) loadingEl.style.display = "none";
                    if (containerEl) containerEl.style.display = "block";

                    // Setup form handlers
                    setupEditMode();
                    setupProfileFormHandler(profile);
                    setupDeleteAccount(profile);
                    if (profile.document_url) {
                        setupDeleteHandler(profile.id);
                    } else {
                        setupUploadHandler(profile.id);
                    }
                } catch (error) {
                    console.error("Error loading profile:", error);
                    window.location.href = "/daivai/login";
                }
            }

            function setupEditMode() {
                const editToggleBtn =
                    document.getElementById("edit-toggle-btn");
                const cancelBtn = document.getElementById("cancel-edit-btn");
                const formActions = document.querySelector(".form-actions");
                const editableFields =
                    document.querySelectorAll(".editable-field");

                let originalValues: Record<string, string> = {};

                editToggleBtn?.addEventListener("click", () => {
                    // Save original values
                    editableFields.forEach((field) => {
                        const inputField = field as HTMLInputElement;
                        originalValues[inputField.id] = inputField.value;
                        inputField.removeAttribute("readonly");
                    });

                    // Show form actions, hide edit button
                    if (formActions)
                        (formActions as HTMLElement).style.display = "flex";
                    if (editToggleBtn) editToggleBtn.style.display = "none";
                });

                cancelBtn?.addEventListener("click", () => {
                    // Restore original values
                    editableFields.forEach((field) => {
                        const inputField = field as HTMLInputElement;
                        inputField.value = originalValues[inputField.id] || "";
                        inputField.setAttribute("readonly", "true");
                    });

                    // Hide form actions, show edit button
                    if (formActions)
                        (formActions as HTMLElement).style.display = "none";
                    if (editToggleBtn)
                        editToggleBtn.style.display = "inline-flex";

                    // Clear status messages
                    const status = document.getElementById("form-status");
                    if (status) {
                        status.textContent = "";
                        status.className = "form-status";
                    }
                });
            }

            function setupProfileFormHandler(profile: any) {
                const form = document.getElementById("profile-form");
                const status = document.getElementById("form-status");

                form?.addEventListener("submit", async (e) => {
                    e.preventDefault();

                    const formData = {
                        first_name: (
                            document.getElementById(
                                "first_name",
                            ) as HTMLInputElement
                        )?.value,
                        last_name: (
                            document.getElementById(
                                "last_name",
                            ) as HTMLInputElement
                        )?.value,
                        birth_date: (
                            document.getElementById(
                                "birth_date",
                            ) as HTMLInputElement
                        )?.value,
                        phone: (
                            document.getElementById("phone") as HTMLInputElement
                        )?.value,
                        address: (
                            document.getElementById(
                                "address",
                            ) as HTMLInputElement
                        )?.value,
                        city: (
                            document.getElementById("city") as HTMLInputElement
                        )?.value,
                        postal_code: (
                            document.getElementById(
                                "postal_code",
                            ) as HTMLInputElement
                        )?.value,
                    };

                    if (status) {
                        status.textContent = "Salvataggio...";
                        status.className = "form-status loading";
                    }

                    const { error } = await supabase
                        .from("profiles")
                        .update(formData)
                        .eq("id", profile.id);

                    if (error) {
                        if (status) {
                            status.textContent = `Errore: ${error.message}`;
                            status.className = "form-status error";
                        }
                    } else {
                        if (status) {
                            status.textContent =
                                "‚úì Profilo aggiornato con successo!";
                            status.className = "form-status success";
                        }

                        // Return to view mode after successful save
                        setTimeout(() => {
                            const editableFields =
                                document.querySelectorAll(".editable-field");
                            editableFields.forEach((field) => {
                                field.setAttribute("readonly", "true");
                            });

                            const formActions =
                                document.querySelector(".form-actions");
                            const editToggleBtn =
                                document.getElementById("edit-toggle-btn");

                            if (formActions)
                                (formActions as HTMLElement).style.display =
                                    "none";
                            if (editToggleBtn)
                                editToggleBtn.style.display = "inline-flex";

                            if (status) {
                                status.textContent = "";
                                status.className = "form-status";
                            }
                        }, 2000);
                    }
                });
            }

            function setupUploadHandler(userId: string) {
                const form = document.getElementById("upload-form");
                const status = document.getElementById("upload-status");
                const fileInput = document.getElementById(
                    "doc-file",
                ) as HTMLInputElement;

                form?.addEventListener("submit", async (e) => {
                    e.preventDefault();

                    if (!fileInput || !fileInput.files) {
                        if (status) {
                            status.textContent =
                                "Errore: elemento file non trovato";
                            status.className = "upload-status error";
                        }
                        return;
                    }

                    const file = fileInput.files[0];
                    if (!file) {
                        if (status) {
                            status.textContent = "Seleziona un file";
                            status.className = "upload-status error";
                        }
                        return;
                    }

                    if (file.type !== "application/pdf") {
                        if (status) {
                            status.textContent = "Il file deve essere un PDF";
                            status.className = "upload-status error";
                        }
                        return;
                    }

                    if (file.size > 5 * 1024 * 1024) {
                        if (status) {
                            status.textContent = "Il file non pu√≤ superare 5MB";
                            status.className = "upload-status error";
                        }
                        return;
                    }

                    if (status) {
                        status.textContent = "Caricamento...";
                        status.className = "upload-status loading";
                    }

                    const filePath = `${userId}/document.pdf`;
                    const { error: uploadError } = await supabase.storage
                        .from("user-documents")
                        .upload(filePath, file, { upsert: true });

                    if (uploadError) {
                        if (status) {
                            status.textContent = `Errore: ${uploadError.message}`;
                            status.className = "upload-status error";
                        }
                        return;
                    }

                    const {
                        data: { publicUrl },
                    } = supabase.storage
                        .from("user-documents")
                        .getPublicUrl(filePath);

                    const { error: updateError } = await supabase
                        .from("profiles")
                        .update({ document_url: publicUrl })
                        .eq("id", userId);

                    if (updateError) {
                        if (status) {
                            status.textContent = `Errore: ${updateError.message}`;
                            status.className = "upload-status error";
                        }
                    } else {
                        if (status) {
                            status.textContent = "‚úì Documento caricato!";
                            status.className = "upload-status success";
                        }
                        setTimeout(() => location.reload(), 1500);
                    }
                });
            }

            function setupDeleteHandler(userId: string) {
                const btn = document.getElementById(
                    "delete-doc",
                ) as HTMLButtonElement | null;

                btn?.addEventListener("click", async () => {
                    if (!confirm("Vuoi eliminare il documento?")) return;

                    btn.textContent = "Eliminazione...";
                    btn.disabled = true;

                    const filePath = `${userId}/document.pdf`;
                    await supabase.storage
                        .from("user-documents")
                        .remove([filePath]);
                    await supabase
                        .from("profiles")
                        .update({ document_url: null })
                        .eq("id", userId);

                    location.reload();
                });
            }

            // Logout handler
            const logoutBtn = document.getElementById("logout-btn");
            logoutBtn?.addEventListener("click", async () => {
                await supabase.auth.signOut();
                window.location.href = "/daivai/";
            });

            // Delete Account Logic
            function setupDeleteAccount(profile: any) {
                const deleteBtn = document.getElementById("delete-account-btn");
                const modal = document.getElementById("delete-modal");
                const closeModalBtns = document.querySelectorAll(
                    ".close-modal, .btn-cancel-modal",
                );
                const confirmDeleteBtn = document.getElementById(
                    "confirm-delete-btn",
                ) as HTMLButtonElement;
                const emailInput = document.getElementById(
                    "confirm-email",
                ) as HTMLInputElement;

                // Open Modal
                deleteBtn?.addEventListener("click", () => {
                    if (modal) modal.style.display = "flex";
                    if (emailInput) {
                        emailInput.value = "";
                        emailInput.focus();
                    }
                });

                // Close Modal
                const closeModal = () => {
                    if (modal) modal.style.display = "none";
                };

                closeModalBtns.forEach((btn) => {
                    btn.addEventListener("click", closeModal);
                });

                // Close on outside click
                window.addEventListener("click", (e) => {
                    if (e.target === modal) {
                        closeModal();
                    }
                });

                // Email Validation
                emailInput?.addEventListener("input", (e) => {
                    const target = e.target as HTMLInputElement;
                    if (confirmDeleteBtn) {
                        const isMatch = target.value === profile.email;
                        confirmDeleteBtn.disabled = !isMatch;
                        if (isMatch) {
                            confirmDeleteBtn.classList.add("active");
                        } else {
                            confirmDeleteBtn.classList.remove("active");
                        }
                    }
                });

                // Confirm Delete
                confirmDeleteBtn?.addEventListener("click", async () => {
                    try {
                        confirmDeleteBtn.textContent = "Eliminazione...";
                        confirmDeleteBtn.disabled = true;

                        // 1. Delete Document if exists
                        if (profile.document_url) {
                            const filePath = `${profile.id}/document.pdf`;
                            await supabase.storage
                                .from("user-documents")
                                .remove([filePath]);
                        }

                        // 2. Delete Profile Data
                        const { error } = await supabase
                            .from("profiles")
                            .delete()
                            .eq("id", profile.id);

                        if (error) throw error;

                        // 3. Sign Out
                        await supabase.auth.signOut();

                        // 4. Redirect
                        window.location.href = "/daivai/";
                    } catch (error) {
                        console.error("Delete error:", error);
                        alert(
                            "Errore durante l'eliminazione del profilo. Riprova.",
                        );
                        confirmDeleteBtn.textContent =
                            "Elimina Definitivamente";
                        confirmDeleteBtn.disabled = false;
                    }
                });
            }

            // Load profile on page load
            loadProfile();
        </script>
    </body>
</html>

<style>
    body {
        font-family: "Gotham", sans-serif;
        background-color: var(--primary-color);
        min-height: 100vh;
        color: white;
    }

    .profile-page {
        padding: 8rem 2rem 4rem;
        min-height: 100vh;
    }

    .profile-container {
        max-width: 1000px;
        margin: 0 auto;
    }

    .profile-header {
        text-align: center;
        margin-bottom: 4rem;
        position: relative;
    }

    .profile-header h1 {
        font-family: var(--font-heading);
        font-size: clamp(3rem, 6vw, 5rem);
        margin-bottom: 0.5rem;
        font-weight: 400;
        letter-spacing: 2px;
        text-transform: uppercase;
        color: white;
    }

    .highlight {
        color: var(--secondary-color);
    }

    .profile-subtitle {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1.1rem;
        font-family: "Gotham", sans-serif;
        font-weight: 400;
    }

    .admin-badge {
        display: inline-block;
        margin-top: 1.5rem;
        padding: 0.75rem 2rem;
        background: var(--secondary-color);
        border-radius: 30px;
        font-weight: 700;
        color: #1a1a2e;
        box-shadow: 0 4px 15px rgba(245, 229, 144, 0.3);
        font-family: var(--font-heading);
        letter-spacing: 1px;
    }

    .profile-content {
        margin-bottom: 3rem;
    }

    .profile-actions {
        display: flex;
        justify-content: center;
        gap: 2rem;
        flex-wrap: wrap;
    }

    .btn-back,
    .btn-admin,
    .btn-logout {
        padding: 1.2rem 2.5rem;
        border-radius: 12px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        font-size: 1rem;
        font-family: "Gotham", sans-serif;
        letter-spacing: 0.5px;
    }

    .btn-back {
        background: rgba(255, 255, 255, 0.15);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.4);
    }

    .btn-back:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgba(255, 255, 255, 0.2);
    }

    .btn-admin {
        background: var(--secondary-color);
        color: #1a1a2e;
        border: none;
        box-shadow: 0 4px 15px rgba(245, 229, 144, 0.3);
    }

    .btn-admin:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(245, 229, 144, 0.5);
    }

    .btn-logout {
        background: rgba(255, 255, 255, 0.15);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.4);
        cursor: pointer;
    }

    .btn-logout:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgba(255, 255, 255, 0.2);
    }

    @media (max-width: 768px) {
        .profile-page {
            padding: 6rem 1rem 3rem;
        }

        .profile-actions {
            flex-direction: column;
            align-items: stretch;
        }

        .btn-back,
        .btn-admin,
        .btn-logout {
            text-align: center;
        }
    }
</style>

<style>
    /* Loading State */
    .loading-container {
        text-align: center;
        padding: 4rem 2rem;
        color: white;
        font-size: 1.2rem;
    }

    /* Form Header with Edit Button */
    .form-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .form-header h3 {
        margin: 0;
    }

    .btn-edit-toggle {
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 2rem;
        background-color: var(--primary-color);
        color: var(--secondary-color);
        border: 2px solid var(--secondary-color);
        border-radius: 50px;
        font-family: "Condenso", sans-serif;
        font-size: 1.2rem;
        font-weight: 400;
        letter-spacing: 1px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-edit-toggle:hover {
        transform: scale(1.05);
        background-color: var(--secondary-color);
        color: var(--primary-color);
        border-color: var(--primary-color);
    }

    .btn-edit-toggle svg {
        flex-shrink: 0;
    }

    .form-actions {
        display: flex;
        gap: 1rem;
        margin-top: 1.5rem;
    }

    .btn-cancel {
        padding: 1rem 2rem;
        background: transparent;
        color: rgba(255, 255, 255, 0.7);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-cancel:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.5);
    }

    /* Form Section Styles */
    .form-section,
    .document-section {
        background: transparent;
        border-radius: 20px;
        padding: 2.5rem 0;
        margin-bottom: 2.5rem;
        border: none;
        box-shadow: none;
    }

    .form-section h3,
    .document-section h3 {
        font-family: var(--font-heading);
        color: white;
        font-size: 2rem;
        margin: 0;
        font-weight: 400;
        letter-spacing: 1px;
        text-transform: uppercase;
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .form-group {
        display: flex;
        flex-direction: column;
    }

    .form-group.full-width {
        grid-column: 1 / -1;
    }

    .form-group label {
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: rgba(255, 255, 255, 0.9);
    }

    :global(.form-group input) {
        padding: 1rem 1.25rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1.5px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        color: white;
        font-size: 1rem;
        font-family: "Gotham", sans-serif;
        transition: all 0.3s ease;
    }

    :global(.form-group input:focus) {
        outline: none;
        border-color: var(--primary-color);
        background: rgba(255, 255, 255, 0.15);
        box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);
    }

    :global(.form-group input[readonly]),
    :global(.form-group input.always-readonly) {
        background: transparent !important;
        border: none !important;
        padding-left: 0;
        opacity: 0.9;
        cursor: default;
    }

    :global(.form-group input.always-readonly) {
        opacity: 0.7;
    }

    .btn-submit {
        padding: 1.2rem 3.5rem;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 12px;
        font-weight: 700;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        font-family: "Gotham", sans-serif;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        box-shadow: 0 4px 15px rgba(var(--primary-rgb), 0.3);
    }

    .btn-submit:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(var(--primary-rgb), 0.5);
    }

    /* Form Status Messages */
    .form-status,
    .upload-status {
        margin-top: 1rem;
        padding: 0.8rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        text-align: center;
    }

    .form-status.loading,
    .upload-status.loading {
        background: rgba(var(--primary-rgb), 0.1);
        color: var(--primary-color);
    }

    .form-status.success,
    .upload-status.success {
        background: rgba(40, 167, 69, 0.1);
        color: #28a745;
    }

    .form-status.error,
    .upload-status.error {
        background: rgba(220, 53, 69, 0.1);
        color: #dc3545;
    }

    /* Document Section */
    .document-preview {
        text-align: center;
        padding: 2rem;
    }

    .document-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 1.5rem;
    }

    .btn-view,
    .btn-delete,
    .btn-upload {
        padding: 0.8rem 2rem;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
    }

    .btn-view {
        background: var(--primary-color);
        color: white;
        border: none;
    }

    .btn-view:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(var(--primary-rgb), 0.4);
    }

    .btn-delete {
        background: rgba(220, 53, 69, 0.2);
        color: #dc3545;
        border: 2px solid #dc3545;
    }

    .btn-delete:hover {
        background: rgba(220, 53, 69, 0.3);
    }

    .btn-upload {
        background: var(--primary-color);
        color: white;
        border: none;
        margin-top: 1rem;
    }

    .btn-upload:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(var(--primary-rgb), 0.4);
    }

    #doc-file {
        padding: 1rem;
        background: rgba(255, 255, 255, 0.08);
        border: 2px dashed rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    #doc-file:hover {
        border-color: var(--primary-color);
        background: rgba(255, 255, 255, 0.12);
    }

    /* Danger Zone Styles */
    .danger-zone {
        border: 1px solid rgba(255, 59, 48, 0.3);
        border-radius: 20px;
        padding: 2rem;
        margin-top: 4rem;
        background: rgba(255, 59, 48, 0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1.5rem;
    }

    .danger-header h3 {
        color: #ff3b30;
        font-family: var(--font-heading);
        margin-bottom: 0.5rem;
        font-size: 1.5rem;
    }

    .danger-header p {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.9rem;
    }

    .btn-danger {
        background: transparent;
        border: 2px solid #ff3b30;
        color: #ff3b30;
        padding: 0.8rem 1.5rem;
        border-radius: 12px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-family: var(--font-heading);
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .btn-danger:hover {
        background: #ff3b30;
        color: white;
    }

    /* Modal Styles */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
        z-index: 1000;
        display: none; /* Hidden by default */
        justify-content: center;
        align-items: center;
        opacity: 0;
        animation: fadeIn 0.3s forwards;
    }

    .modal-content {
        background: #1a1a1a;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 24px;
        width: 90%;
        max-width: 500px;
        padding: 2rem;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        transform: scale(0.9);
        animation: scaleUp 0.3s forwards;
    }

    @keyframes fadeIn {
        to {
            opacity: 1;
        }
    }

    @keyframes scaleUp {
        to {
            transform: scale(1);
        }
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 1rem;
    }

    .modal-header h3 {
        color: white;
        font-family: var(--font-heading);
        font-size: 1.5rem;
    }

    .close-modal {
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.5);
        font-size: 2rem;
        line-height: 1;
        cursor: pointer;
        transition: color 0.3s;
    }

    .close-modal:hover {
        color: white;
    }

    .modal-body p {
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.6;
        margin-bottom: 1.5rem;
    }

    .confirmation-input label {
        display: block;
        margin-bottom: 0.8rem;
        color: rgba(255, 255, 255, 0.9);
        font-size: 0.95rem;
    }

    .confirmation-input input {
        width: 100%;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.05);
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        color: white;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .confirmation-input input:focus {
        outline: none;
        border-color: #ff3b30;
        background: rgba(255, 59, 48, 0.05);
    }

    .modal-footer {
        margin-top: 2rem;
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
    }

    .btn-cancel-modal {
        background: transparent;
        border: none;
        color: rgba(255, 255, 255, 0.6);
        padding: 0.8rem 1.5rem;
        cursor: pointer;
        font-family: var(--font-heading);
        font-size: 0.9rem;
        transition: color 0.3s;
    }

    .btn-cancel-modal:hover {
        color: white;
    }

    .btn-delete-confirm {
        background: rgba(255, 59, 48, 0.2);
        color: rgba(255, 255, 255, 0.5);
        border: none;
        padding: 0.8rem 1.5rem;
        border-radius: 12px;
        cursor: not-allowed;
        font-family: var(--font-heading);
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .btn-delete-confirm.active {
        background: #ff3b30;
        color: white;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(255, 59, 48, 0.3);
    }

    .btn-delete-confirm.active:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 59, 48, 0.4);
    }

    @media (max-width: 768px) {
        .form-grid {
            grid-template-columns: 1fr;
        }

        .document-actions {
            flex-direction: column;
        }

        .btn-view,
        .btn-delete {
            width: 100%;
        }
    }
</style>
